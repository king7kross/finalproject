<h2 class="page-title">Cart</h2>

<section *ngIf="loading" class="state">Loading...</section>

<section *ngIf="!loading && (!cart || cart.items.length === 0)" class="empty-card">
  <strong>No Items in Cart</strong>
</section>

<section *ngIf="!loading && cart && cart.items.length > 0">
  <div class="table-card">
    <table class="cart-table">
      <thead>
        <tr>
          <th>Product</th>
          <th class="right">Price</th>
          <th class="right">Discount</th>
          <th class="center">Qty</th>
          <th class="right">Subtotal</th>
          <th class="right">Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let it of cart!.items">
          <td>
            <div class="product">
              <img
                *ngIf="it.productImageUrl"
                [src]="it.productImageUrl"
                alt=""
                class="product-img"
              />
              <div class="product-meta">
                <div class="product-name">{{ it.productName }}</div>
                <div class="product-sub">Available: {{ it.availableQuantity }}</div>
              </div>
            </div>
          </td>

          <td class="right mono">{{ it.price | currency:'INR':'symbol' }}</td>
          <td class="right mono">{{ (it.discount || 0) | currency:'INR':'symbol' }}</td>

          <td class="center">
            <select
              class="select"
              [(ngModel)]="it.quantity"
              (ngModelChange)="onQtyChange(it)"
              [disabled]="updatingId === it.id"
            >
              <option *ngFor="let n of qtyOptions(it)" [value]="n">{{ n }}</option>
            </select>
          </td>

          <td class="right mono">
            {{ (it.price - (it.discount || 0)) * it.quantity | currency:'INR':'symbol' }}
          </td>

          <td class="right">
            <button class="btn btn-ghost danger" (click)="remove(it)" [disabled]="updatingId === it.id">
              Remove
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="cart-actions">
    <button class="btn btn-primary" (click)="placeOrder()" [disabled]="placing">
      Place Order
    </button>
  </div>
</section>
